FILE: index.html
POSTS = data.posts || [];
renderCards(POSTS);
renderMap(POSTS);
// Se l'URL ha ?open=slug apri direttamente la pagina articolo
const url = new URL(location.href);
const openSlug = url.searchParams.get('open');
if(openSlug){ location.href = `/articoli/${openSlug}.html`; }
}


// ====== RENDER CARD ======
const cards = document.getElementById('cards');
function renderCards(list){
cards.innerHTML = '';
list.slice(0,3).forEach(p => { // 3 pi√π recenti
const a = document.createElement('a');
a.href = `/articoli/${p.slug}.html`;
a.className = 'card';
a.innerHTML = `
<img src="${p.img}" alt="${p.title}"/>
<div class="content">
<span class="badge">${p.city}</span>
<h3>${p.title}</h3>
<p>${p.excerpt}</p>
</div>`;
cards.appendChild(a);
});
}


// ====== MAPPA ======
function renderMap(list){
const map = L.map('map',{scrollWheelZoom:false});
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
const group = L.featureGroup();
list.forEach(p=>{
const m = L.marker(p.coords).addTo(group).bindPopup(`
<strong>${p.title}</strong><br>${p.city}<br>
<a href="/articoli/${p.slug}.html">Apri articolo</a>`);
});
group.addTo(map);
map.fitBounds(group.getBounds().pad(0.3));
}


// ====== SLIDESHOW (4 foto che cambiano ogni 3s) ======
const slides = [...document.querySelectorAll('.slide')];
let idx = 0; setInterval(()=>{ slides[idx].classList.remove('active'); idx = (idx+1)%slides.length; slides[idx].classList.add('active'); }, 3000);


// ====== THEME TOGGLE & INIT ======
const themeBtn = document.getElementById('themeBtn');
function setTheme(t){ document.body.classList.toggle('light', t==='light'); localStorage.setItem('theme', t); }
themeBtn.addEventListener('click', ()=> setTheme(document.body.classList.contains('light')?'dark':'light'));


document.getElementById('year').textContent = new Date().getFullYear();
setTheme(localStorage.getItem('theme')||'dark');
loadPosts();
</script>
</body>
</html>

